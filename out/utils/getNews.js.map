{"version":3,"sources":["../../src/utils/getNews.ts"],"sourcesContent":["import { Browser } from \"puppeteer\";\r\nimport { getBrowser } from \"../lib/BrowserEnv.js\";\r\n\r\nexport const getNews = async () => {\r\n  let previousHeight;\r\n  let items: any[] = [];\r\n  const scrollDelay = 600;\r\n  const itemCount = 30;\r\n  const url = \"https://www.bing.com\";\r\n  const main = async () => {\r\n    const browser: Browser = await getBrowser();\r\n    const page = await browser.newPage();\r\n    await page.goto(\r\n      \"https://www.bing.com/news/search?q=covid+india&qs=SS&form=QBNT&sp=1&ghc=1&lq=0&pq=covid+i&sc=8-7&cvid=C4FA65AF3DDC4FFEBE08DB0494E374F4\"\r\n    );\r\n    while (items.length < itemCount) {\r\n      previousHeight = await page.evaluate(\"document.body.scrollHeight\");\r\n      await page.evaluate(\"window.scrollTo(0, document.body.scrollHeight)\");\r\n      await page.waitForFunction(\r\n        `document.body.scrollHeight > ${previousHeight}`\r\n      );\r\n      // await page.waitForTimeout(scrollDelay);\r\n      new Promise((r) => setTimeout(r, scrollDelay));\r\n      const news = await page.evaluate((url) => {\r\n        const newsList = Array.from(document?.querySelectorAll(\".news-card\"));\r\n\r\n        const data = newsList.map((news) => {\r\n          return {\r\n            image:\r\n              url + news.querySelector(\".imagelink>img\")?.getAttribute(\"src\") ||\r\n              \"\",\r\n            title: news.querySelector(\".caption a.title\")?.textContent || \"\",\r\n            description: news.querySelector(\".snippet\")?.textContent || \" \",\r\n            url:\r\n              news.querySelector(\".caption a.title\")?.getAttribute(\"href\") ||\r\n              \" \",\r\n            validTill: new Date().getTime() + 1000 * 60 * 60 * 6,\r\n          };\r\n        });\r\n        return data;\r\n      }, url);\r\n      items = [...items, ...news];\r\n    }\r\n\r\n    setTimeout(async () => {\r\n      await page.close();\r\n      await browser.close();\r\n    }, 0);\r\n    return items;\r\n  };\r\n  const data = await main();\r\n\r\n  return data;\r\n};\r\n"],"names":["getBrowser","getNews","previousHeight","items","scrollDelay","itemCount","url","main","data","browser","page","news","newPage","goto","length","evaluate","waitForFunction","Promise","r","setTimeout","newsList","Array","from","document","querySelectorAll","map","image","querySelector","getAttribute","title","textContent","description","validTill","Date","getTime","close"],"mappings":"2xFACA,OAASA,UAAU,KAAQ,sBAAuB,AAElD,QAAO,IAAMC,4BAAU,oBAAA,UAAY,KAC7BC,eACAC,MACEC,YACAC,UACAC,IACAC,KAyCAC,4EA7CFL,SACEC,YAAc,IACdC,UAAY,GACZC,IAAM,uBACNC,yBAAO,oBAAA,UAAY,KACjBE,QACAC,KAYEC,4EAbiB,SAAMX,qBAAzBS,QAAmB,cACZ,SAAMA,QAAQG,OAAO,WAA5BF,KAAO,cACb,SAAMA,KAAKG,IAAI,CACb,kJADF,wCAGOV,CAAAA,MAAMW,MAAM,CAAGT,SAAQ,cACX,SAAMK,KAAKK,QAAQ,CAAC,sCAArCb,eAAiB,cACjB,SAAMQ,KAAKK,QAAQ,CAAC,0DAApB,cACA,SAAML,KAAKM,eAAe,CACxB,AAAC,gCAA8C,OAAfd,yBADlC,cAIA,IAAIe,QAAQ,SAACC,UAAMC,WAAWD,EAAGd,eACpB,SAAMM,KAAKK,QAAQ,CAAC,SAACT,IAAQ,CACxC,IAAMc,SAAWC,MAAMC,IAAI,CAACC,iBAAAA,kBAAAA,KAAAA,EAAAA,SAAUC,gBAAgB,CAAC,eAEvD,IAAMhB,KAAOY,SAASK,GAAG,CAAC,SAACd,KAAS,KAGxBA,oBAEDA,qBACMA,qBAEXA,qBAPJ,MAAO,CACLe,MACEpB,KAAMK,CAAAA,oBAAAA,KAAKgB,aAAa,CAAC,2BAAnBhB,6BAAAA,KAAAA,EAAAA,oBAAsCiB,aAAa,SACzD,GACFC,MAAOlB,CAAAA,CAAAA,qBAAAA,KAAKgB,aAAa,CAAC,6BAAnBhB,8BAAAA,KAAAA,EAAAA,qBAAwCmB,WAAW,AAAD,GAAK,GAC9DC,YAAapB,CAAAA,CAAAA,qBAAAA,KAAKgB,aAAa,CAAC,qBAAnBhB,8BAAAA,KAAAA,EAAAA,qBAAgCmB,WAAW,AAAD,GAAK,IAC5DxB,IACEK,CAAAA,CAAAA,qBAAAA,KAAKgB,aAAa,CAAC,6BAAnBhB,8BAAAA,KAAAA,EAAAA,qBAAwCiB,aAAa,UACrD,IACFI,UAAW,IAAIC,OAAOC,OAAO,GAAK,IAAO,GAAK,GAAK,CACrD,CACF,GACA,OAAO1B,IACT,EAAGF,aAjBGK,KAAO,cAkBbR,MAAQ,AAAC,qBAAGA,cAAO,qBAAGQ,0BAGxBQ,WAAW,oBAAA,UAAY,wEACrB,SAAMT,KAAKyB,KAAK,WAAhB,cACA,SAAM1B,QAAQ0B,KAAK,WAAnB,0BACF,GAAG,GACH,SAAOhC,SACT,mBAxCMI,6CAyCO,SAAMA,eAAbC,KAAO,cAEb,SAAOA,QACT,mBAlDaP,+CAkDX"}